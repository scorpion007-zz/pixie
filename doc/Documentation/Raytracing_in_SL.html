<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="keywords" content="Documentation/Raytracing in SL" />
<link rel="shortcut icon" href="favicon.ico" />
		<title>Documentation/Raytracing in SL - PixieWiki</title>
		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "../css/main.css?7"; /*]]>*/</style>
		<link rel="stylesheet" type="text/css"  href="../css/commonPrint.css" />
		<!--[if lt IE 5.5000]><style type="text/css">@import "../css/IE50Fixes.css";</style><![endif]-->
		<!--[if IE 5.5000]><style type="text/css">@import "../css/IE55Fixes.css";</style><![endif]-->
		<!--[if IE 6]><style type="text/css">@import "../css/IE60Fixes.css";</style><![endif]-->
		<!--[if IE 7]><style type="text/css">@import "../css/IE70Fixes.css?1";</style><![endif]-->
		<!--[if lt IE 7]><script type="text/javascript" src="../css/IEFixes.js"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
		<script type="text/javascript">var skin = 'monobook';var stylepath = '/pixiewiki/skins';</script>
		<script type="text/javascript" src="../css/wikibits.js"><!-- wikibits js --></script>
		<script type="text/javascript" src="../css/WikiExtraJs.js"><!-- site js --></script>
		<style type="text/css">/*<![CDATA[*/
@import "../css/MediaWiki_Common.css";
@import "../css/MediaWiki_Monobook.css";
@import "../css/WikiExtraCss.css";
/*]]>*/</style>
		<!-- Head Scripts -->
			</head>
<body  class="ns-0 ltr">
 <div id="titleBar"></div>
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="contentTop"></a>
				<h1 class="firstHeading">Documentation/Raytracing in SL</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From PixieWiki</h3>
			<div id="contentSub"><span class="subpages">&lt; <a href="../Documentation.html" title="Documentation">Documentation</a></span></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<p><br />
</p>
<table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class='toclevel-1'><a href="#Raytracing_in_shading_language"><span class="tocnumber">1</span> <span class="toctext">Raytracing in shading language</span></a>
<ul>
<li class='toclevel-2'><a href="#trace"><span class="tocnumber">1.1</span> <span class="toctext">trace</span></a></li>
<li class='toclevel-2'><a href="#gather"><span class="tocnumber">1.2</span> <span class="toctext">gather</span></a></li>
<li class='toclevel-2'><a href="#tranmission"><span class="tocnumber">1.3</span> <span class="toctext">tranmission</span></a></li>
<li class='toclevel-2'><a href="#indirectdiffuse"><span class="tocnumber">1.4</span> <span class="toctext">indirectdiffuse</span></a></li>
<li class='toclevel-2'><a href="#occlusion"><span class="tocnumber">1.5</span> <span class="toctext">occlusion</span></a></li>
<li class='toclevel-2'><a href="#raydepth"><span class="tocnumber">1.6</span> <span class="toctext">raydepth</span></a></li>
<li class='toclevel-2'><a href="#raylabel"><span class="tocnumber">1.7</span> <span class="toctext">raylabel</span></a></li>
<li class='toclevel-2'><a href="#rayinfo"><span class="tocnumber">1.8</span> <span class="toctext">rayinfo</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../NotSupportedStatic.html" title="Edit section: Raytracing in shading language">edit</a>]</div><a name="Raytracing_in_shading_language"></a><h1> Raytracing in shading language </h1>
<p>For an object to be raytraced, it must be marked as raytraceable by setting the visibility attribute.
</p>
<pre>Attribute "visibility" "trace" 1
</pre>
<p>The following new shading language constructs and functions are available:
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../NotSupportedStatic.html" title="Edit section: trace">edit</a>]</div><a name="trace"></a><h2> trace </h2>
<pre>color trace(point P,vector R);
float trace(point P,vector R);
</pre>
<p>The <tt>trace</tt> shadeop fires a single ray from <tt>P</tt> in direction <tt>R</tt> and returns either the color hit (the color version) or the percentage visibility (the float version).  You can use the explicit prefix in situations which are ambiguous.  Trace also takes these optional arguments:
</p>
<table class="wikitable">
<tr>
<td> <tt>uniform float bias</tt> </td><td>		The self intersection bias.
</td></tr>
<tr>
<td> <tt>uniform string label</tt></td><td>		A label for the ray
</td></tr></table>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../NotSupportedStatic.html" title="Edit section: gather">edit</a>]</div><a name="gather"></a><h2> gather </h2>
<pre>gather(	string category,
    point P,
    vector dir,
    float angle,
    ...)
    statement
    [else statement]
</pre>
<p>This construct is very similar to PrMan 11's gather construct. It will shoot <tt>numSamples</tt> rays rooted at <tt>P</tt> distributed in a cone centered at <tt>dir</tt> making <tt>angle</tt> angles. For each ray that hits something, the first statement will be executed. Otherwise  else statement will be executed. The following optional parameters can be provided:
</p>
<table class="wikitable">
<tr>
<td> <tt>uniform float bias</tt> </td><td>		The self intersection bias.
</td></tr>
<tr>
<td> <tt>uniform float maxdist</tt></td><td>		The maximum intersection distance
</td></tr>
<tr>
<td> <tt>uniform string distribution</tt> </td><td>		The sample distribution (<tt>"cosine"</tt> or <tt>"uniform"</tt>)
</td></tr>
<tr>
<td> <tt>uniform string label</tt></td><td>		The ray label
</td></tr>
<tr>
<td> <tt>varying type shadertype:variablename</tt></td><td>	The query value (output)
</td></tr>
<tr>
<td> <tt>varying float ray:length</tt></td><td>	Length of the ray (output)
</td></tr>
<tr>
<td> <tt>varying vector ray:direction</tt></td><td>	The ray direction (output)
</td></tr></table>
<p>For example:
</p>
<pre>color totalColor = 0;
color hitColor;
float numHits = 0;
gather("irradiance",P,N,PI/2,256,"surface:Ci",hitColor) {
    totalColor += hitColor;
    numHits++;
}
totalColor /= numHits;
</pre>
<p>is equivalent to
</p>
<pre>totalColor = indirectdiffuse(P,N,256);
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../NotSupportedStatic.html" title="Edit section: tranmission">edit</a>]</div><a name="tranmission"></a><h2> tranmission </h2>
<pre>color transmission(point P1,point P2,...);
</pre>
<p>This function gives the transmission between the two points. This function can be used to get raytraced shadows in light source shaders:
</p>
<pre>illuminate (from) {
    Cl = transmission(Ps,from) * intensity * lightcolor / (L . L);
}
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../NotSupportedStatic.html" title="Edit section: indirectdiffuse">edit</a>]</div><a name="indirectdiffuse"></a><h2> indirectdiffuse </h2>
<pre>color indirectdiffuse(point P,vector N,float numSamples ...);
</pre>
<p>This function gives the average irradiance as seen be a hemisphere centered at  <tt>P</tt> <tt>N</tt>. The irradiance is computed by raytracing.  numSamples gives the number of rays to shoot. Depending on the  irradiance attributes of the current primitive, this value can be cached. The following optional parameters can be provided:
</p>
<table class="wikitable">
<tr>
<td> <tt>uniform float minR</tt> </td><td>		The minimum distance between samples.
</td></tr>
<tr>
<td> <tt>uniform float maxR</tt> </td><td>		The maximum distance between samples.
</td></tr>
<tr>
<td> <tt>uniform float bias</tt> </td><td>		Self intersection bias
</td></tr>
<tr>
<td> <tt>varying float occlusion</tt> </td><td>	The occlusion amount (output)
</td></tr>
<tr>
<td> <tt>uniform float maxdist</tt> </td><td>		The maximum intersection distance
</td></tr>
<tr>
<td> <tt>uniform vector backgroundColor</tt> </td><td>		This color will be used for rays that don't hit anything
</td></tr>
<tr>
<td> <tt>uniform float maxBrightness</tt> </td><td>		The ray brightness will be clamped by this number to avoid splotchy results
</td></tr>
<tr>
<td> <tt>uniform string environmentmap</tt> </td><td>		The incoming color for rays which don't hit anything will be estimated by sampling this map if specified
</td></tr>
<tr>
<td> <tt>output varying vector environmentdir</tt> </td><td>		The argument takes a variable, into which the average unoccluded environment direction will be placed
</td></tr>
<tr>
<td> <tt>output varying color occlusion</tt> </td><td>		The argument takes a variable, into which the value of occlusion will be placed
</td></tr></table>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../NotSupportedStatic.html" title="Edit section: occlusion">edit</a>]</div><a name="occlusion"></a><h2> occlusion </h2>
<pre>float occlusion(point P,vector N,float numSamples ...);
</pre>
<p>This function computes the fraction of the hemisphere that is not occluded by another geometry. The interpretation of the parameters is the same with  indirectdiffuse. The following parameters can be passed:
</p>
<table class="wikitable">
<tr>
<td> <tt>uniform float minR</tt></td><td>		The closest distance between samples.
</td></tr>
<tr>
<td> <tt>uniform float maxR</tt></td><td>		The maximum distance between samples.
</td></tr>
<tr>
<td> <tt>uniform float bias</tt></td><td>		Self intersection bias
</td></tr>
<tr>
<td> <tt>varying color irradiance</tt></td><td>	The irradiance amount (output)
</td></tr>
<tr>
<td> <tt>uniform float maxdist</tt></td><td>		The maximum intersection distance
</td></tr></table>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../NotSupportedStatic.html" title="Edit section: raydepth">edit</a>]</div><a name="raydepth"></a><h2> raydepth </h2>
<pre>uniform float raydepth();
</pre>
<p>This function returns the depth of the current shading point. It returns 0 for the camera rays.
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../NotSupportedStatic.html" title="Edit section: raylabel">edit</a>]</div><a name="raylabel"></a><h2> raylabel </h2>
<pre>uniform string raylabel();
</pre>
<p>This function returns the label of ray that caused the shading. You can assign labels to rays that are generated by the  gather statement.
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../NotSupportedStatic.html" title="Edit section: rayinfo">edit</a>]</div><a name="rayinfo"></a><h2> rayinfo </h2>
<pre>uniform float rayinfo(uniform string arg,varying &lt;type&gt; val);
</pre>
<p>The <tt>rayinfo</tt> shadeop returns information about a ray.  The <tt>arg</tt> parameter specifies which piece of information to fetch.  The value will be placed in <tt>val</tt>.  If no value can be found, <tt>rayinfo</tt> returns 0.  The table below shows what information can be obtained.  Note it's that values are premoted to varying as each ray hitting the surface can have different values.
</p>
<table class="wikitable">
<tr>
<td> <tt>varying string label</tt></td><td>  The label of the ray
</td></tr>
<tr>
<td> <tt>varying float depth</tt></td><td>  The depth of the ray
</td></tr>
<tr>
<td> <tt>varying point origin</tt></td><td>  The origin of the ray (<tt>P</tt> where it was fired from)
</td></tr>
<tr>
<td> <tt>varying vector direction</tt></td><td>  The direction of the ray (<tt>R</tt> when it was fired)
</td></tr>
<tr>
<td> <tt>varying float length</tt></td><td>  The length of the ray (distance from <tt>P</tt>)
</td></tr></table>

<!-- Saved in parser cache with key georgeg_pixiewikidb:pcache:idhash:1539-0!1!0!0!!en!2 and timestamp 20060714222820 -->
<div class="printfooter">
Retrieved from "<a href="http://www.george-graphics.co.uk/pixiewiki/index.php/Documentation/Raytracing_in_SL">http://www.george-graphics.co.uk/pixiewiki/index.php/Documentation/Raytracing_in_SL</a>"</div>
			<div id="catlinks"><p class='catlinks'><a href="../NotSupportedStatic.html" title="Special:Categories">Category</a>: <span dir='ltr'><a href="../Category_Documentation.html" title="Category:Documentation">Documentation</a></span></p></div>			<!-- end content -->
			<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<ul>
				 <li id="ca-nstab-main" class="selected"><a href="../Documentation/Raytracing_in_SL.html">Article</a></li>
				 <li id="ca-talk" class="new"><a href="../NotSupportedStatic.html">Discussion</a></li>
				 <li id="ca-edit"><a href="../NotSupportedStatic.html">Edit</a></li>
				 <li id="ca-history"><a href="../NotSupportedStatic.html">History</a></li>
		</ul>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="../NotSupportedStatic.html">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(/pixiewiki/skins/common/images/wiki.png);" href="../NotIncludedStatic.html" title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage"><a href="../NotIncludedStatic.html">Main Page</a></li>
				<li id="n-portal"><a href="../NotSupportedStatic.html">Community portal</a></li>
				<li id="n-currentevents"><a href="../NotIncludedStatic.html">Current events</a></li>
				<li id="n-recentchanges"><a href="../NotSupportedStatic.html">Recent changes</a></li>
				<li id="n-randompage"><a href="../NotSupportedStatic.html">Random page</a></li>
				<li id="n-help"><a href="../NotSupportedStatic.html">Help</a></li>
			</ul>
		</div>
	</div>
		<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="../NotSupportedStatic.html" id="searchform"><div>
				<input id="searchInput" name="search" type="text" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" value="Search" />
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="../NotSupportedStatic.html">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="../NotSupportedStatic.html">Related changes</a></li>
<li id="t-upload"><a href="../NotSupportedStatic.html">Upload file</a></li>
<li id="t-specialpages"><a href="../NotSupportedStatic.html">Special pages</a></li>
				<li id="t-print"><a href="../NotSupportedStatic.html">Printable version</a></li>				<li id="t-permalink"><a href="/pixiewiki/index.php?title=Documentation/Raytracing_in_SL&amp;oldid=1970">Permanent link</a></li>			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../css/images/poweredby_mediawiki_88x31.png" alt="MediaWiki" /></a></div>
			<ul id="f-list">
				<li id="f-lastmod"> This page was last modified 10:16, 6 May 2006.</li>
				<li id="f-viewcount">This page has been accessed 329 times.</li>
				<li id="f-privacy"><a href="../NotSupportedStatic.html" title="PixieWiki:Privacy policy">Privacy policy</a></li>
				<li id="f-about"><a href="../NotSupportedStatic.html" title="PixieWiki:About">About PixieWiki</a></li>
				<li id="f-disclaimer"><a href="../NotSupportedStatic.html" title="PixieWiki:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
	<script type="text/javascript"> if (window.runOnloadHook) runOnloadHook();</script>
</div>
<!-- Served by mercury.svr9-speedyservers.com in 0.17 secs. -->
</body></html>
